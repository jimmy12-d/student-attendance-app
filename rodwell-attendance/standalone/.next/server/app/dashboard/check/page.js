(()=>{var e={};e.id=866,e.ids=[866],e.modules={10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},19121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},55511:e=>{"use strict";e.exports=require("crypto")},14985:e=>{"use strict";e.exports=require("dns")},94735:e=>{"use strict";e.exports=require("events")},29021:e=>{"use strict";e.exports=require("fs")},81630:e=>{"use strict";e.exports=require("http")},73496:e=>{"use strict";e.exports=require("http2")},91645:e=>{"use strict";e.exports=require("net")},21820:e=>{"use strict";e.exports=require("os")},33873:e=>{"use strict";e.exports=require("path")},19771:e=>{"use strict";e.exports=require("process")},27910:e=>{"use strict";e.exports=require("stream")},34631:e=>{"use strict";e.exports=require("tls")},79551:e=>{"use strict";e.exports=require("url")},28354:e=>{"use strict";e.exports=require("util")},74075:e=>{"use strict";e.exports=require("zlib")},73131:(e,t,a)=>{"use strict";a.r(t),a.d(t,{GlobalError:()=>n.a,__next_app__:()=>u,pages:()=>c,routeModule:()=>h,tree:()=>d});var r=a(70260),s=a(28203),l=a(25155),n=a.n(l),i=a(67292),o={};for(let e in i)0>["default","tree","pages","GlobalError","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>i[e]);a.d(t,o);let d=["",{children:["dashboard",{children:["check",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(a.bind(a,34480)),"/Users/jimmy/datta-able-free-react-admin-template/student-attendance-app/app/dashboard/check/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(a.bind(a,83748)),"/Users/jimmy/datta-able-free-react-admin-template/student-attendance-app/app/dashboard/layout.tsx"]}]},{layout:[()=>Promise.resolve().then(a.bind(a,19611)),"/Users/jimmy/datta-able-free-react-admin-template/student-attendance-app/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(a.t.bind(a,19937,23)),"next/dist/client/components/not-found-error"],forbidden:[()=>Promise.resolve().then(a.t.bind(a,69116,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(a.t.bind(a,41485,23)),"next/dist/client/components/unauthorized-error"]}],c=["/Users/jimmy/datta-able-free-react-admin-template/student-attendance-app/app/dashboard/check/page.tsx"],u={require:a,loadChunk:()=>Promise.resolve()},h=new r.AppPageRouteModule({definition:{kind:s.RouteKind.APP_PAGE,page:"/dashboard/check/page",pathname:"/dashboard/check",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},80379:(e,t,a)=>{Promise.resolve().then(a.bind(a,34480))},90995:(e,t,a)=>{Promise.resolve().then(a.bind(a,35285))},15660:(e,t,a)=>{"use strict";a.d(t,{A:()=>n});var r=a(45512),s=a(83877);let l=({htmlFor:e,children:t,...a})=>(0,r.jsx)("label",{htmlFor:e,className:`block mb-2 font-semibold ${e?"cursor-pointer":""} ${a.className??""}`,children:(0,r.jsx)("span",{className:"line-clamp-1",children:t})}),n=({children:e,...t})=>{let a={className:["px-3 py-2 max-w-full border-gray-700 rounded-sm w-full dark:placeholder-gray-400","focus:ring-3 focus:ring-blue-600 focus:border-blue-600 focus:outline-hidden",t.hasTextareaHeight?"h-24":"h-12",t.isBorderless?"border-0":"border",t.isTransparent?"bg-transparent":"bg-white dark:bg-slate-800",t.icon?"pl-10":""].join(" ")};return(0,r.jsxs)("div",{className:"mb-2 last:mb-0",children:[t.label&&(0,r.jsx)(l,{htmlFor:t.labelFor,children:t.label}),(0,r.jsxs)("div",{className:"relative",children:[e(a),t.icon&&(0,r.jsx)(s.A,{path:t.icon,w:"w-10",h:t.hasTextareaHeight?"h-full":"h-12",className:"absolute top-0 left-0 z-10 pointer-events-none text-gray-500 dark:text-slate-400"})]}),t.help&&(0,r.jsx)("div",{className:"text-xs text-gray-500 dark:text-slate-400 mt-1",children:t.help})]})}},35285:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>N});var r=a(45512),s=a(58009),l=a(12113),n=a(6204),i=a(80874),o=a(24719),d=a(66055),c=a(33883),u=a(15660),h=a(83877);let p=({options:e,selectedValues:t,onChange:a,placeholder:n="Select options...",buttonClassName:i,fieldData:o,id:d})=>{let[c,u]=(0,s.useState)(!1),[p,m]=(0,s.useState)(""),x=(0,s.useRef)(null),g=(0,s.useRef)(null),f=(0,s.useMemo)(()=>p.trim()?e.filter(e=>e.label.toLowerCase().includes(p.toLowerCase())):e,[e,p]),b=e=>{a(t.includes(e)?t.filter(t=>t!==e):[...t,e])};(0,s.useEffect)(()=>{let e=e=>{x.current&&!x.current.contains(e.target)&&u(!1)};return c?(document.addEventListener("mousedown",e),setTimeout(()=>g.current?.focus(),0)):m(""),()=>{document.removeEventListener("mousedown",e)}},[c]);let j=o?.className?`${o.className.replace("px-3 py-2","px-3 py-2.5")} text-left inline-flex items-center justify-between ${i||""}`:`text-black relative w-full bg-white border border-gray-300 hover:border-gray-400 focus:ring-4 focus:outline-none focus:ring-indigo-300 font-medium rounded-lg text-sm px-3 py-2.5 text-left inline-flex items-center justify-between shadow-sm dark:bg-slate-800 dark:border-gray-600 dark:text-white dark:focus:ring-indigo-500 ${i||""}`,y=f.length>0&&f.every(e=>t.includes(e.value));return(0,r.jsxs)("div",{className:"relative w-full",ref:x,children:[(0,r.jsxs)("button",{type:"button",id:d,onClick:()=>u(!c),className:j,"aria-haspopup":"listbox","aria-expanded":c,children:[(0,r.jsx)("span",{className:"truncate",children:0===t.length?n:e.length>0&&t.length===e.length?`All Selected (${e.length})`:t.length<=2?t.map(t=>e.find(e=>e.value===t)?.label).filter(Boolean).join(", "):`${t.length} items selected`}),(0,r.jsx)(h.A,{path:l.W5x,w:"h-5 w-5",className:`ml-2 transform transition-transform duration-200 ${c?"rotate-180":""}`})]}),c&&(0,r.jsxs)("div",{className:"z-20 absolute mt-1 w-full bg-white rounded-lg shadow-xl dark:bg-gray-700 border border-gray-200 dark:border-gray-600 max-h-72 flex flex-col",children:[(0,r.jsx)("div",{className:"p-2 border-b border-gray-200 dark:border-gray-600 sticky top-0 bg-white dark:bg-gray-700",children:(0,r.jsx)("input",{ref:g,type:"text",placeholder:"Search options...",className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-md dark:bg-gray-800 dark:border-gray-500 dark:text-white focus:ring-indigo-500 focus:border-indigo-500",value:p,onChange:e=>m(e.target.value),onClick:e=>e.stopPropagation()})}),(0,r.jsxs)("ul",{className:"flex-grow overflow-y-auto py-1",role:"listbox",children:[f.length>0&&(0,r.jsx)("li",{className:"px-2 py-2 hover:bg-gray-100 dark:hover:bg-gray-600 cursor-pointer",children:(0,r.jsxs)("label",{className:"flex items-center space-x-3 text-sm text-gray-900 dark:text-gray-100",children:[(0,r.jsx)("input",{type:"checkbox",className:"form-checkbox h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500 dark:border-gray-500 dark:focus:ring-indigo-600",checked:y,onChange:()=>{let e=f.map(e=>e.value),r=e.length>0&&e.every(e=>t.includes(e)),s=[...t];r?s=s.filter(t=>!e.includes(t)):e.forEach(e=>{s.includes(e)||s.push(e)}),a(s)}}),(0,r.jsxs)("span",{children:[y?"Deselect All Shown":"Select All Shown"," (",f.length,")"]})]})}),f.map(e=>(0,r.jsx)("li",{className:"px-2 py-2 hover:bg-gray-100 dark:hover:bg-gray-600 cursor-pointer",children:(0,r.jsxs)("label",{className:"flex items-center space-x-3 text-sm text-gray-900 dark:text-gray-100",children:[(0,r.jsx)("input",{type:"checkbox",className:"form-checkbox h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500 dark:border-gray-500 dark:focus:ring-indigo-600",value:e.value,checked:t.includes(e.value),onChange:()=>b(e.value)}),(0,r.jsx)("span",{children:e.label})]})},e.value)),e.length>0&&0===f.length&&p&&(0,r.jsxs)("li",{className:"px-4 py-2 text-sm text-gray-500 dark:text-gray-400",children:["No options match",p]}),0===e.length&&(0,r.jsx)("li",{className:"px-4 py-2 text-sm text-gray-500 dark:text-gray-400",children:"No options available"})]})]})]})};var m=a(17656),x=a(95900);let g=e=>{let t;if(!e)return"N/A";if("string"==typeof e){let a=e.split("-");t=3!==a.length||isNaN(parseInt(a[0]))||isNaN(parseInt(a[1]))||isNaN(parseInt(a[2]))?new Date(e):new Date(parseInt(a[0]),parseInt(a[1])-1,parseInt(a[2]))}else if(e instanceof m.Dc)t=e.toDate();else{if(!(e instanceof Date))return"Invalid Date Type";t=e}if(isNaN(t.getTime()))return"Invalid Date";let a=String(t.getDate()).padStart(2,"0"),r=String(t.getMonth()+1).padStart(2,"0"),s=t.getFullYear();return`${a}-${r}-${s}`},f=({statuses:e,perPage:t=10,onViewDetails:a})=>{let[n,i]=(0,s.useState)(0),o=e.slice(t*n,t*(n+1)),d=Math.ceil(e.length/t),u=[];for(let e=0;e<d;e++)u.push(e);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)("table",{children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{children:"Student Name"}),(0,r.jsx)("th",{children:"Class"}),(0,r.jsx)("th",{children:"Shift"}),(0,r.jsx)("th",{children:"Date"}),(0,r.jsx)("th",{children:"Status"}),(0,r.jsx)("th",{children:"Time"}),(0,r.jsx)("th",{children:"Details"})]})}),(0,r.jsx)("tbody",{children:o.map(e=>(0,r.jsxs)("tr",{children:[(0,r.jsx)("td",{"data-label":"Student Name",children:e.fullName}),(0,r.jsx)("td",{"data-label":"Class",children:e.class||"N/A"}),(0,r.jsx)("td",{"data-label":"Shift",children:e.shift||"N/A"}),(0,r.jsx)("td",{"data-label":"Date",className:"whitespace-nowrap",children:g(e.attendanceDate)}),(0,r.jsx)("td",{"data-label":"Status",children:(0,r.jsx)("span",{className:`px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full ${"Present"===e.attendanceStatus?"bg-green-200 text-green-800":"Late"===e.attendanceStatus?"bg-yellow-100 text-yellow-800 border border-yellow-300":"Absent"===e.attendanceStatus?"bg-red-200 text-red-800":"Pending"===e.attendanceStatus?"bg-blue-200 text-blue-800":"Permission"===e.attendanceStatus?"bg-purple-200 text-purple-800":"bg-gray-100 text-gray-800"}`,children:e.attendanceStatus})}),(0,r.jsx)("td",{"data-label":"Time",className:"whitespace-nowrap",children:("Present"===e.attendanceStatus||"Late"===e.attendanceStatus)&&e.actualTimestamp?e.actualTimestamp instanceof m.Dc?e.actualTimestamp.toDate().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!0}):e.actualTimestamp instanceof Date?e.actualTimestamp.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!0}):"N/A":"N/A"}),(0,r.jsxs)("td",{className:"before:hidden lg:w-1 whitespace-nowrap text-center",children:[" ",(0,r.jsx)(c.A,{icon:l.WCY,onClick:()=>a(e),color:"info",small:!0,outline:!0})]})]},e.id))})]})}),(0,r.jsx)("div",{className:"p-3 lg:px-6 border-t border-gray-100 dark:border-slate-800",children:(0,r.jsxs)("div",{className:"flex flex-col md:flex-row items-center justify-between py-3 md:py-0",children:[(0,r.jsx)(x.A,{children:u.map(e=>(0,r.jsx)(c.A,{active:e===n,label:(e+1).toString(),color:e===n?"lightDark":"whiteDark",small:!0,onClick:()=>i(e),isGrouped:!0},e))}),(0,r.jsxs)("small",{className:"mt-6 md:mt-0",children:["Page ",n+1," of ",d," (Total: ",e.length," records)"]})]})})]})};var b=a(48518),j=a(65167),y=a(92021),v=a(72462);let k=()=>{let e=new Date,t=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),r=String(e.getDate()).padStart(2,"0");return`${t}-${a}-${r}`};function N(){let[e,t]=(0,s.useState)(k()),[a,h]=(0,s.useState)([]),[x,g]=(0,s.useState)([]),[N,w]=(0,s.useState)(""),[S,A]=(0,s.useState)([]),[C,D]=(0,s.useState)(null),[P,M]=(0,s.useState)([]),[q,$]=(0,s.useState)([]),[_,T]=(0,s.useState)([]),[I,E]=(0,s.useState)(!1),[F,L]=(0,s.useState)(!0),[G,U]=(0,s.useState)(null),[R,z]=(0,s.useState)(!1),[Y,J]=(0,s.useState)(null),V=["Morning","Afternoon","Evening"].map(e=>({value:e,label:e})),B=(0,s.useCallback)((e,t)=>{U(t),setTimeout(()=>U(null),5e3)},[]),H=(0,s.useCallback)(async()=>{if(E(!0),U(null),T([]),M([]),$([]),!e){B("error","Please select a date."),E(!1);return}if(0===a.length&&0===x.length){B("info","Please select at least one class or shift to generate a report."),E(!1);return}try{let t=(0,m.rJ)(j.db,"students"),r=(0,m.rJ)(j.db,"attendance"),s=(0,m.rJ)(j.db,"permissions"),l=[];a.length>0?l.push((0,m._M)("class","in",a)):l.push((0,m._M)("shift","in",x));let n=(0,m.P)(t,...l),i=(await (0,m.GG)(n)).docs.map(e=>({id:e.id,...e.data()})),o=a.length>0&&x.length>0?i.filter(e=>e.shift&&x.includes(e.shift)):i;if(0===o.length){B("info","No students match the selected criteria."),T([]),E(!1);return}let d=o.map(e=>e.id),c=[],u=[];if(d.length>0){let e=new Date;e.setDate(e.getDate()-60);let t=`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`,a=[],l=[];for(let e=0;e<d.length;e+=30){let n=d.slice(e,e+30),i=(0,m.P)(r,(0,m._M)("studentId","in",n),(0,m._M)("date",">=",t)),o=(0,m.P)(s,(0,m._M)("studentId","in",n),(0,m._M)("status","==","approved"));a.push((0,m.GG)(i)),l.push((0,m.GG)(o))}let[n,i]=await Promise.all([Promise.all(a),Promise.all(l)]);n.flat().forEach(e=>e.docs.forEach(e=>{c.push({id:e.id,studentId:e.data().studentId,...e.data()})})),M(c),i.flat().forEach(e=>e.docs.forEach(e=>{u.push({id:e.id,...e.data()})})),$(u)}let h=new Map;c.filter(t=>t.date===e).forEach(e=>h.set(e.studentId,e));let p=o.map(t=>{let a=h.get(t.id),r=u.filter(e=>e.studentId===t.id),s=(0,v.tE)(t,e,a,C,r);return{...t,attendanceDate:e,attendanceStatus:s.status,actualTimestamp:a?.timestamp}}),g=""!==N.trim()?p.filter(e=>e.fullName.toLowerCase().includes(N.toLowerCase())):p;T(g)}catch(e){console.error("Error fetching data:",e),e instanceof Error&&"code"in e?"failed-precondition"===e.code&&e.message.includes("index")?U("Query requires a new index. Please check the browser console for a link to create it."):U("Failed to fetch data. Please try again."):U("An unknown error occurred.")}E(!1)},[e,a,x,N,B,C]),W=(0,s.useCallback)(e=>{J(e),z(!0)},[]),K=a=>{let r=e.split("-").map(e=>parseInt(e,10)),s=new Date(r[0],r[1]-1,r[2]);s.setDate(s.getDate()+a);let l=s.getFullYear(),n=String(s.getMonth()+1).padStart(2,"0"),i=String(s.getDate()).padStart(2,"0");t(`${l}-${n}-${i}`)};return(0,r.jsxs)(n.A,{children:[(0,r.jsx)(i.A,{icon:l.U4M,title:"Check Daily Attendance Status",main:!0}),(0,r.jsxs)(o.A,{className:"mb-6 px-4 pt-2 pb-4 rounded-lg shadow",children:[(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-4 items-start",children:[(0,r.jsx)(u.A,{label:"Date",labelFor:"checkDate",children:a=>(0,r.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,r.jsx)(c.A,{icon:l.LyG,onClick:()=>K(-1),color:"lightDark",small:!0,outline:!0}),(0,r.jsx)("input",{type:"date",id:"checkDate",value:e,onChange:e=>t(e.target.value),className:`${a.className} flex-grow`}),(0,r.jsx)(c.A,{icon:l.mI8,onClick:()=>K(1),color:"lightDark",small:!0,outline:!0})]})}),(0,r.jsx)(u.A,{label:"Class",labelFor:"checkClassMulti",children:e=>(0,r.jsx)(p,{id:"checkClassMulti",options:S,selectedValues:a,onChange:h,placeholder:F?"Loading classes...":0===S.length?"No classes available":"Select Class",fieldData:e})}),(0,r.jsx)(u.A,{label:"Shift",labelFor:"checkShiftMulti",children:e=>(0,r.jsx)(p,{id:"checkShiftMulti",options:V,selectedValues:x,onChange:g,placeholder:"Select Shift",fieldData:e})}),(0,r.jsx)(u.A,{label:"Student Name (Filter)",labelFor:"checkName",children:e=>(0,r.jsx)("input",{type:"text",id:"checkName",placeholder:"Search by name...",value:N,onChange:e=>w(e.target.value),className:e.className})})]}),(0,r.jsx)("div",{className:"flex justify-start",children:(0,r.jsx)(c.A,{label:"Check Status",color:"info",icon:l.U4M,onClick:()=>{H()},disabled:I||!e||0===a.length&&0===x.length})})]}),G&&(0,r.jsx)(d.A,{color:"danger",icon:l.tPJ,className:"mb-4",children:G}),(0,r.jsx)(o.A,{className:"mb-6 rounded-lg shadow",hasTable:!0,children:I?(0,r.jsx)("p",{className:"p-6 text-center",children:"Loading student statuses..."}):_.length>0?(0,r.jsx)(f,{statuses:_,onViewDetails:W}):e&&(a.length>0||x.length>0)&&!G?(0,r.jsx)(d.A,{color:"info",icon:l.U4M,children:"No students found for the selected criteria."}):(0,r.jsx)(d.A,{color:"info",children:"Please select a date and at least one class or shift to get a report."})}),R&&Y&&C&&(0,r.jsx)(b.A,{student:Y,attendanceRecords:P.filter(e=>e.studentId===Y.id),approvedPermissions:q.filter(e=>e.studentId===Y.id),allClassConfigs:C,isActive:R,onClose:()=>{z(!1),J(null)},initialMonthValue:(0,y.AZ)(new Date(e))})]})}},34480:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>r});let r=(0,a(46760).registerClientReference)(function(){throw Error("Attempted to call the default export of \"/Users/jimmy/datta-able-free-react-admin-template/student-attendance-app/app/dashboard/check/page.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/Users/jimmy/datta-able-free-react-admin-template/student-attendance-app/app/dashboard/check/page.tsx","default")}};var t=require("../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),r=t.X(0,[750,790,113,206,906,401],()=>a(73131));module.exports=r})();