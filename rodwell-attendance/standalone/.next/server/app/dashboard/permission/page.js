(()=>{var e={};e.id=137,e.ids=[137],e.modules={10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},19121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},55511:e=>{"use strict";e.exports=require("crypto")},14985:e=>{"use strict";e.exports=require("dns")},94735:e=>{"use strict";e.exports=require("events")},29021:e=>{"use strict";e.exports=require("fs")},81630:e=>{"use strict";e.exports=require("http")},73496:e=>{"use strict";e.exports=require("http2")},91645:e=>{"use strict";e.exports=require("net")},21820:e=>{"use strict";e.exports=require("os")},33873:e=>{"use strict";e.exports=require("path")},19771:e=>{"use strict";e.exports=require("process")},27910:e=>{"use strict";e.exports=require("stream")},34631:e=>{"use strict";e.exports=require("tls")},79551:e=>{"use strict";e.exports=require("url")},28354:e=>{"use strict";e.exports=require("util")},74075:e=>{"use strict";e.exports=require("zlib")},92763:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>n.a,__next_app__:()=>u,pages:()=>c,routeModule:()=>p,tree:()=>o});var r=s(70260),a=s(28203),i=s(25155),n=s.n(i),l=s(67292),d={};for(let e in l)0>["default","tree","pages","GlobalError","__next_app__","routeModule"].indexOf(e)&&(d[e]=()=>l[e]);s.d(t,d);let o=["",{children:["dashboard",{children:["permission",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,77949)),"/Users/jimmy/datta-able-free-react-admin-template/student-attendance-app/app/dashboard/permission/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,83748)),"/Users/jimmy/datta-able-free-react-admin-template/student-attendance-app/app/dashboard/layout.tsx"]}]},{layout:[()=>Promise.resolve().then(s.bind(s,19611)),"/Users/jimmy/datta-able-free-react-admin-template/student-attendance-app/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,19937,23)),"next/dist/client/components/not-found-error"],forbidden:[()=>Promise.resolve().then(s.t.bind(s,69116,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(s.t.bind(s,41485,23)),"next/dist/client/components/unauthorized-error"]}],c=["/Users/jimmy/datta-able-free-react-admin-template/student-attendance-app/app/dashboard/permission/page.tsx"],u={require:s,loadChunk:()=>Promise.resolve()},p=new r.AppPageRouteModule({definition:{kind:a.RouteKind.APP_PAGE,page:"/dashboard/permission/page",pathname:"/dashboard/permission",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:o}})},74910:(e,t,s)=>{Promise.resolve().then(s.bind(s,77949))},43366:(e,t,s)=>{Promise.resolve().then(s.bind(s,43295))},66055:(e,t,s)=>{"use strict";s.d(t,{A:()=>o});var r=s(45512),a=s(12113),i=s(58009),n=s(37954),l=s(33883),d=s(83877);let o=({outline:e=!1,children:t,...s})=>{let o=e?n.Fw[s.color]:n.cu[s.color],[c,u]=(0,i.useState)(!1);return c?null:(0,r.jsx)("div",{className:`px-3 py-6 md:py-3 mb-6 last:mb-0 border rounded-lg transition-colors duration-150 ${o}`,children:(0,r.jsxs)("div",{className:"flex flex-col md:flex-row items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex flex-col md:flex-row items-center mb-6 md:mb-0",children:[s.icon&&(0,r.jsx)(d.A,{path:s.icon,w:"w-10 md:w-5",h:"h-10 md:h-5",size:"24",className:"md:mr-2"}),(0,r.jsx)("span",{className:"text-center md:text-left md:py-2",children:t})]}),s.button,!s.button&&(0,r.jsx)(l.A,{icon:a.hyP,color:"white",onClick:e=>{e.preventDefault(),u(!0)},small:!0,roundedFull:!0})]})})}},80874:(e,t,s)=>{"use strict";s.d(t,{A:()=>l});var r=s(45512);s(58009);var a=s(83877),i=s(37954);function n({icon:e,color:t,w:s="w-12",h:n="h-12",bg:l=!1,className:d=""}){let o=l?i.cu[t]:`${i.Wj[t]} bg-gray-50 dark:bg-slate-800`;return(0,r.jsx)(a.A,{path:e,w:s,h:n,size:"24",className:`rounded-full ${o} ${d}`})}function l({icon:e,title:t,main:s=!1,children:i}){return(0,r.jsxs)("section",{className:`${s?"":"pt-6"} mb-6 flex items-center justify-between`,children:[(0,r.jsxs)("div",{className:"flex items-center justify-start",children:[e&&s&&(0,r.jsx)(n,{icon:e,color:"light",className:"mr-3",bg:!0}),e&&!s&&(0,r.jsx)(a.A,{path:e,className:"mr-2",size:"20"}),(0,r.jsx)("h1",{className:`leading-tight ${s?"text-3xl":"text-2xl"}`,children:t})]}),i]})}},43295:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>b});var r=s(45512),a=s(58009),i=s(12113),n=s(6204),l=s(80874),d=s(24719),o=s(33883),c=s(95900);let u=e=>e?e.toDate().toLocaleString("default",{day:"numeric",month:"long"}):"N/A",p=e=>{if(!e)return"N/A";let t=e.split("-");if(3!==t.length)return e;let s=parseInt(t[0]),r=parseInt(t[1])-1,a=parseInt(t[2]);return isNaN(s)||isNaN(r)||isNaN(a)?e:new Date(s,r,a).toLocaleString("default",{day:"2-digit",month:"long"})},m=({permissions:e,onUpdateRequest:t})=>{let s=e=>"approved"===e?"bg-green-100 text-green-800":"rejected"===e?"bg-red-100 text-red-800":"pending"===e?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800";return(0,r.jsxs)("table",{children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{children:"Student Name"}),(0,r.jsx)("th",{children:"Class & Shift"}),(0,r.jsx)("th",{children:"Permission Dates"}),(0,r.jsx)("th",{children:"Reason"}),(0,r.jsx)("th",{children:"Details"}),(0,r.jsx)("th",{children:"Status"}),(0,r.jsx)("th",{children:"Actions"})]})}),(0,r.jsx)("tbody",{children:e.map(e=>(0,r.jsxs)("tr",{children:[(0,r.jsx)("td",{"data-label":"Student Name",children:e.studentName}),(0,r.jsxs)("td",{"data-label":"Class & Shift",className:"whitespace-nowrap",children:[e.class||"N/A"," - ",e.shift||"N/A"]}),(0,r.jsxs)("td",{"data-label":"Permission Dates",className:"whitespace-nowrap",children:[p(e.permissionStartDate)," to ",p(e.permissionEndDate)]}),(0,r.jsx)("td",{"data-label":"Reason",children:e.reason}),(0,r.jsx)("td",{"data-label":"Details",children:(0,r.jsxs)("div",{className:"flex flex-col text-left",children:[" ",(0,r.jsx)("span",{className:"text-sm text-ellipsis overflow-hidden whitespace-nowrap max-w-[200px] block",title:e.details,children:e.details||(0,r.jsx)("span",{className:"text-gray-400 dark:text-slate-500",children:"No details"})}),(0,r.jsxs)("small",{className:"text-gray-500 dark:text-slate-400 whitespace-nowrap",title:`Requested on ${e.requestDate.toDate().toLocaleString()}`,children:["Req: ",u(e.requestDate)]})]})}),(0,r.jsx)("td",{"data-label":"Status",className:"text-center",children:(0,r.jsx)("span",{className:`px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full ${s(e.status)}`,children:e.status&&e.status.charAt(0).toUpperCase()+e.status.slice(1)})}),(0,r.jsx)("td",{className:"before:hidden lg:w-1 whitespace-nowrap",children:(0,r.jsxs)(c.A,{type:"justify-start lg:justify-end",noWrap:!0,children:[(0,r.jsx)(o.A,{color:"success",icon:i.Tfj,onClick:()=>t(e.id,"approved"),small:!0,isGrouped:!0}),(0,r.jsx)(o.A,{color:"danger",icon:i.hyP,onClick:()=>t(e.id,"rejected"),small:!0,isGrouped:!0})]})})]},e.id))})]})};var x=s(65167),h=s(17656),f=s(66055);function b(){let[e,t]=(0,a.useState)([]),[s,o]=(0,a.useState)(!0),[c,u]=(0,a.useState)(null),[p,b]=(0,a.useState)(null),j=(0,a.useCallback)(async()=>{o(!0),u(null);try{let e=(0,h.rJ)(x.db,"permissions"),s=(0,h.rJ)(x.db,"students"),r=(0,h.P)(e,(0,h.My)("requestDate","desc")),[a,i]=await Promise.all([(0,h.GG)(r),(0,h.GG)(s)]),n=new Map;i.docs.forEach(e=>{n.set(e.id,{id:e.id,...e.data()})});let l=a.docs.map(e=>{let t={id:e.id,...e.data()},s=n.get(t.studentId);return{...t,class:s?.class||"N/A",shift:s?.shift||"N/A"}});t(l)}catch(e){console.error(e),"permission-denied"===e.code?u("Permission Denied. Check Firestore security rules for 'permissions' and 'students' collections."):u("Failed to fetch permission requests.")}o(!1)},[]),g=async(e,t)=>{b(null);try{let s=(0,h.H9)(x.db,"permissions",e);await (0,h.mZ)(s,{status:t,reviewedAt:new Date}),b(`Request has been ${t}.`),j()}catch(e){console.error(e),u("Failed to update request status.")}setTimeout(()=>b(null),3e3)};return(0,r.jsxs)(n.A,{children:[(0,r.jsx)(l.A,{icon:i.Esf,title:"Manage Permission Requests",main:!0}),c&&(0,r.jsx)(f.A,{color:"danger",className:"mb-4",children:c}),p&&(0,r.jsx)(f.A,{color:"success",className:"mb-4",children:p}),(0,r.jsx)(d.A,{hasTable:!0,children:s?(0,r.jsx)("p",{className:"p-4 text-center",children:"Loading requests..."}):(0,r.jsx)(m,{permissions:e,onUpdateRequest:g})})]})}},77949:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>r});let r=(0,s(46760).registerClientReference)(function(){throw Error("Attempted to call the default export of \"/Users/jimmy/datta-able-free-react-admin-template/student-attendance-app/app/dashboard/permission/page.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/Users/jimmy/datta-able-free-react-admin-template/student-attendance-app/app/dashboard/permission/page.tsx","default")}};var t=require("../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[750,790,113,206,906],()=>s(92763));module.exports=r})();