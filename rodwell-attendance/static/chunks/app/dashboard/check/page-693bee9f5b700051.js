(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[866],{5069:(e,t,a)=>{Promise.resolve().then(a.bind(a,8928))},3061:(e,t,a)=>{"use strict";a.d(t,{A:()=>i});var l=a(2175),s=a(5155),r=a(2781);let n=e=>{var t,{htmlFor:a,children:r}=e,n=(0,l._)(e,["htmlFor","children"]);return(0,s.jsx)("label",{htmlFor:a,className:"block mb-2 font-semibold ".concat(a?"cursor-pointer":""," ").concat(null!==(t=n.className)&&void 0!==t?t:""),children:(0,s.jsx)("span",{className:"line-clamp-1",children:r})})},i=e=>{var{children:t}=e,a=(0,l._)(e,["children"]);let i={className:["px-3 py-2 max-w-full border-gray-700 rounded-sm w-full dark:placeholder-gray-400","focus:ring-3 focus:ring-blue-600 focus:border-blue-600 focus:outline-hidden",a.hasTextareaHeight?"h-24":"h-12",a.isBorderless?"border-0":"border",a.isTransparent?"bg-transparent":"bg-white dark:bg-slate-800",a.icon?"pl-10":""].join(" ")};return(0,s.jsxs)("div",{className:"mb-2 last:mb-0",children:[a.label&&(0,s.jsx)(n,{htmlFor:a.labelFor,children:a.label}),(0,s.jsxs)("div",{className:"relative",children:[t(i),a.icon&&(0,s.jsx)(r.A,{path:a.icon,w:"w-10",h:a.hasTextareaHeight?"h-full":"h-12",className:"absolute top-0 left-0 z-10 pointer-events-none text-gray-500 dark:text-slate-400"})]}),a.help&&(0,s.jsx)("div",{className:"text-xs text-gray-500 dark:text-slate-400 mt-1",children:a.help})]})}},8928:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>w});var l=a(9233),s=a(5843),r=a(5155),n=a(2115),i=a(1063),c=a(5632),o=a(198),d=a(4713),u=a(657),h=a(2079),g=a(3061),m=a(2781);let x=e=>{let{options:t,selectedValues:a,onChange:l,placeholder:s="Select options...",buttonClassName:c,fieldData:o,id:d}=e,[u,h]=(0,n.useState)(!1),[g,x]=(0,n.useState)(""),p=(0,n.useRef)(null),f=(0,n.useRef)(null),b=(0,n.useMemo)(()=>g.trim()?t.filter(e=>e.label.toLowerCase().includes(g.toLowerCase())):t,[t,g]),j=e=>{l(a.includes(e)?a.filter(t=>t!==e):[...a,e])};(0,n.useEffect)(()=>{let e=e=>{p.current&&!p.current.contains(e.target)&&h(!1)};return u?(document.addEventListener("mousedown",e),setTimeout(()=>{var e;return null===(e=f.current)||void 0===e?void 0:e.focus()},0)):x(""),()=>{document.removeEventListener("mousedown",e)}},[u]);let y=(null==o?void 0:o.className)?"".concat(o.className.replace("px-3 py-2","px-3 py-2.5")," text-left inline-flex items-center justify-between ").concat(c||""):"".concat("text-black relative w-full bg-white border border-gray-300 hover:border-gray-400 focus:ring-4 focus:outline-none focus:ring-indigo-300 font-medium rounded-lg text-sm px-3 py-2.5 text-left inline-flex items-center justify-between shadow-sm dark:bg-slate-800 dark:border-gray-600 dark:text-white dark:focus:ring-indigo-500"," ").concat(c||""),N=b.length>0&&b.every(e=>a.includes(e.value));return(0,r.jsxs)("div",{className:"relative w-full",ref:p,children:[(0,r.jsxs)("button",{type:"button",id:d,onClick:()=>h(!u),className:y,"aria-haspopup":"listbox","aria-expanded":u,children:[(0,r.jsx)("span",{className:"truncate",children:0===a.length?s:t.length>0&&a.length===t.length?"All Selected (".concat(t.length,")"):a.length<=2?a.map(e=>{var a;return null===(a=t.find(t=>t.value===e))||void 0===a?void 0:a.label}).filter(Boolean).join(", "):"".concat(a.length," items selected")}),(0,r.jsx)(m.A,{path:i.W5x,w:"h-5 w-5",className:"ml-2 transform transition-transform duration-200 ".concat(u?"rotate-180":"")})]}),u&&(0,r.jsxs)("div",{className:"z-20 absolute mt-1 w-full bg-white rounded-lg shadow-xl dark:bg-gray-700 border border-gray-200 dark:border-gray-600 max-h-72 flex flex-col",children:[(0,r.jsx)("div",{className:"p-2 border-b border-gray-200 dark:border-gray-600 sticky top-0 bg-white dark:bg-gray-700",children:(0,r.jsx)("input",{ref:f,type:"text",placeholder:"Search options...",className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-md dark:bg-gray-800 dark:border-gray-500 dark:text-white focus:ring-indigo-500 focus:border-indigo-500",value:g,onChange:e=>x(e.target.value),onClick:e=>e.stopPropagation()})}),(0,r.jsxs)("ul",{className:"flex-grow overflow-y-auto py-1",role:"listbox",children:[b.length>0&&(0,r.jsx)("li",{className:"px-2 py-2 hover:bg-gray-100 dark:hover:bg-gray-600 cursor-pointer",children:(0,r.jsxs)("label",{className:"flex items-center space-x-3 text-sm text-gray-900 dark:text-gray-100",children:[(0,r.jsx)("input",{type:"checkbox",className:"form-checkbox h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500 dark:border-gray-500 dark:focus:ring-indigo-600",checked:N,onChange:()=>{let e=b.map(e=>e.value),t=e.length>0&&e.every(e=>a.includes(e)),s=[...a];t?s=s.filter(t=>!e.includes(t)):e.forEach(e=>{s.includes(e)||s.push(e)}),l(s)}}),(0,r.jsxs)("span",{children:[N?"Deselect All Shown":"Select All Shown"," (",b.length,")"]})]})}),b.map(e=>(0,r.jsx)("li",{className:"px-2 py-2 hover:bg-gray-100 dark:hover:bg-gray-600 cursor-pointer",children:(0,r.jsxs)("label",{className:"flex items-center space-x-3 text-sm text-gray-900 dark:text-gray-100",children:[(0,r.jsx)("input",{type:"checkbox",className:"form-checkbox h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500 dark:border-gray-500 dark:focus:ring-indigo-600",value:e.value,checked:a.includes(e.value),onChange:()=>j(e.value)}),(0,r.jsx)("span",{children:e.label})]})},e.value)),t.length>0&&0===b.length&&g&&(0,r.jsxs)("li",{className:"px-4 py-2 text-sm text-gray-500 dark:text-gray-400",children:["No options match",g]}),0===t.length&&(0,r.jsx)("li",{className:"px-4 py-2 text-sm text-gray-500 dark:text-gray-400",children:"No options available"})]})]})]})};var p=a(7058),f=a(7738);let b=e=>{let t;if(!e)return"N/A";if("string"==typeof e){let a=e.split("-");t=3!==a.length||isNaN(parseInt(a[0]))||isNaN(parseInt(a[1]))||isNaN(parseInt(a[2]))?new Date(e):new Date(parseInt(a[0]),parseInt(a[1])-1,parseInt(a[2]))}else if(e instanceof p.Dc)t=e.toDate();else{if(!(e instanceof Date))return"Invalid Date Type";t=e}if(isNaN(t.getTime()))return"Invalid Date";let a=String(t.getDate()).padStart(2,"0"),l=String(t.getMonth()+1).padStart(2,"0"),s=t.getFullYear();return"".concat(a,"-").concat(l,"-").concat(s)},j=e=>{let{statuses:t,perPage:a=10,onViewDetails:l}=e,[s,c]=(0,n.useState)(0),o=t.slice(a*s,a*(s+1)),d=Math.ceil(t.length/a),u=[];for(let e=0;e<d;e++)u.push(e);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)("table",{children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{children:"Student Name"}),(0,r.jsx)("th",{children:"Class"}),(0,r.jsx)("th",{children:"Shift"}),(0,r.jsx)("th",{children:"Date"}),(0,r.jsx)("th",{children:"Status"}),(0,r.jsx)("th",{children:"Time"}),(0,r.jsx)("th",{children:"Details"})]})}),(0,r.jsx)("tbody",{children:o.map(e=>(0,r.jsxs)("tr",{children:[(0,r.jsx)("td",{"data-label":"Student Name",children:e.fullName}),(0,r.jsx)("td",{"data-label":"Class",children:e.class||"N/A"}),(0,r.jsx)("td",{"data-label":"Shift",children:e.shift||"N/A"}),(0,r.jsx)("td",{"data-label":"Date",className:"whitespace-nowrap",children:b(e.attendanceDate)}),(0,r.jsx)("td",{"data-label":"Status",children:(0,r.jsx)("span",{className:"px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full ".concat("Present"===e.attendanceStatus?"bg-green-200 text-green-800":"Late"===e.attendanceStatus?"bg-yellow-100 text-yellow-800 border border-yellow-300":"Absent"===e.attendanceStatus?"bg-red-200 text-red-800":"Pending"===e.attendanceStatus?"bg-blue-200 text-blue-800":"Permission"===e.attendanceStatus?"bg-purple-200 text-purple-800":"bg-gray-100 text-gray-800"),children:e.attendanceStatus})}),(0,r.jsx)("td",{"data-label":"Time",className:"whitespace-nowrap",children:("Present"===e.attendanceStatus||"Late"===e.attendanceStatus)&&e.actualTimestamp?e.actualTimestamp instanceof p.Dc?e.actualTimestamp.toDate().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!0}):e.actualTimestamp instanceof Date?e.actualTimestamp.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!0}):"N/A":"N/A"}),(0,r.jsxs)("td",{className:"before:hidden lg:w-1 whitespace-nowrap text-center",children:[" ",(0,r.jsx)(h.A,{icon:i.WCY,onClick:()=>l(e),color:"info",small:!0,outline:!0})]})]},e.id))})]})}),(0,r.jsx)("div",{className:"p-3 lg:px-6 border-t border-gray-100 dark:border-slate-800",children:(0,r.jsxs)("div",{className:"flex flex-col md:flex-row items-center justify-between py-3 md:py-0",children:[(0,r.jsx)(f.A,{children:u.map(e=>(0,r.jsx)(h.A,{active:e===s,label:(e+1).toString(),color:e===s?"lightDark":"whiteDark",small:!0,onClick:()=>c(e),isGrouped:!0},e))}),(0,r.jsxs)("small",{className:"mt-6 md:mt-0",children:["Page ",s+1," of ",d," (Total: ",t.length," records)"]})]})})]})};var y=a(9496),N=a(5111),v=a(8449),S=a(9532);let k=()=>{let e=new Date,t=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),l=String(e.getDate()).padStart(2,"0");return"".concat(t,"-").concat(a,"-").concat(l)};function w(){let[e,t]=(0,n.useState)(k()),[a,m]=(0,n.useState)([]),[f,b]=(0,n.useState)([]),[w,D]=(0,n.useState)(""),[A,C]=(0,n.useState)([]),[M,P]=(0,n.useState)(null),[E,T]=(0,n.useState)([]),[_,I]=(0,n.useState)([]),[F,L]=(0,n.useState)([]),[G,J]=(0,n.useState)(!1),[Y,V]=(0,n.useState)(!0),[R,U]=(0,n.useState)(null),[z,B]=(0,n.useState)(!1),[H,O]=(0,n.useState)(null),W=["Morning","Afternoon","Evening"].map(e=>({value:e,label:e})),q=(0,n.useCallback)((e,t)=>{U(t),setTimeout(()=>U(null),5e3)},[]);(0,n.useEffect)(()=>{(async()=>{V(!0);try{let e=(0,p.rJ)(N.db,"classes"),t=(0,p.P)(e,(0,p.My)("name")),a=await (0,p.GG)(t),l=[],s={};a.docs.forEach(e=>{let t=e.data();l.push({value:t.name,label:t.name}),s[e.id]=t}),C(l),P(s)}catch(e){console.error("Error fetching initial class data:",e),q("error","Failed to load class list.")}V(!1)})()},[q]);let Q=(0,n.useCallback)(async()=>{if(J(!0),U(null),L([]),T([]),I([]),!e){q("error","Please select a date."),J(!1);return}if(0===a.length&&0===f.length){q("info","Please select at least one class or shift to generate a report."),J(!1);return}try{let t=(0,p.rJ)(N.db,"students"),r=(0,p.rJ)(N.db,"attendance"),n=(0,p.rJ)(N.db,"permissions"),i=[];a.length>0?i.push((0,p._M)("class","in",a)):i.push((0,p._M)("shift","in",f));let c=(0,p.P)(t,...i),o=(await (0,p.GG)(c)).docs.map(e=>(0,l._)({id:e.id},e.data())),d=a.length>0&&f.length>0?o.filter(e=>e.shift&&f.includes(e.shift)):o;if(0===d.length){q("info","No students match the selected criteria."),L([]),J(!1);return}let u=d.map(e=>e.id),h=[],g=[];if(u.length>0){let e=new Date;e.setDate(e.getDate()-60);let t="".concat(e.getFullYear(),"-").concat(String(e.getMonth()+1).padStart(2,"0"),"-").concat(String(e.getDate()).padStart(2,"0")),a=[],s=[];for(let e=0;e<u.length;e+=30){let l=u.slice(e,e+30),i=(0,p.P)(r,(0,p._M)("studentId","in",l),(0,p._M)("date",">=",t)),c=(0,p.P)(n,(0,p._M)("studentId","in",l),(0,p._M)("status","==","approved"));a.push((0,p.GG)(i)),s.push((0,p.GG)(c))}let[i,c]=await Promise.all([Promise.all(a),Promise.all(s)]);i.flat().forEach(e=>e.docs.forEach(e=>{h.push((0,l._)({id:e.id,studentId:e.data().studentId},e.data()))})),T(h),c.flat().forEach(e=>e.docs.forEach(e=>{g.push((0,l._)({id:e.id},e.data()))})),I(g)}let m=new Map;h.filter(t=>t.date===e).forEach(e=>m.set(e.studentId,e));let x=d.map(t=>{let a=m.get(t.id),r=g.filter(e=>e.studentId===t.id),n=(0,S.tE)(t,e,a,M,r);return(0,s._)((0,l._)({},t),{attendanceDate:e,attendanceStatus:n.status,actualTimestamp:null==a?void 0:a.timestamp})}),b=""!==w.trim()?x.filter(e=>e.fullName.toLowerCase().includes(w.toLowerCase())):x;L(b)}catch(e){console.error("Error fetching data:",e),e instanceof Error&&"code"in e?"failed-precondition"===e.code&&e.message.includes("index")?U("Query requires a new index. Please check the browser console for a link to create it."):U("Failed to fetch data. Please try again."):U("An unknown error occurred.")}J(!1)},[e,a,f,w,q,M]),Z=(0,n.useCallback)(e=>{O(e),B(!0)},[]),K=a=>{let l=e.split("-").map(e=>parseInt(e,10)),s=new Date(l[0],l[1]-1,l[2]);s.setDate(s.getDate()+a);let r=s.getFullYear(),n=String(s.getMonth()+1).padStart(2,"0"),i=String(s.getDate()).padStart(2,"0");t("".concat(r,"-").concat(n,"-").concat(i))};return(0,n.useEffect)(()=>{a.length>0||f.length>0?Q():(L([]),T([]),I([]))},[e,a,f,Q]),(0,r.jsxs)(c.A,{children:[(0,r.jsx)(o.A,{icon:i.U4M,title:"Check Daily Attendance Status",main:!0}),(0,r.jsxs)(d.A,{className:"mb-6 px-4 pt-2 pb-4 rounded-lg shadow",children:[(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-4 items-start",children:[(0,r.jsx)(g.A,{label:"Date",labelFor:"checkDate",children:a=>(0,r.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,r.jsx)(h.A,{icon:i.LyG,onClick:()=>K(-1),color:"lightDark",small:!0,outline:!0}),(0,r.jsx)("input",{type:"date",id:"checkDate",value:e,onChange:e=>t(e.target.value),className:"".concat(a.className," flex-grow")}),(0,r.jsx)(h.A,{icon:i.mI8,onClick:()=>K(1),color:"lightDark",small:!0,outline:!0})]})}),(0,r.jsx)(g.A,{label:"Class",labelFor:"checkClassMulti",children:e=>(0,r.jsx)(x,{id:"checkClassMulti",options:A,selectedValues:a,onChange:m,placeholder:Y?"Loading classes...":0===A.length?"No classes available":"Select Class",fieldData:e})}),(0,r.jsx)(g.A,{label:"Shift",labelFor:"checkShiftMulti",children:e=>(0,r.jsx)(x,{id:"checkShiftMulti",options:W,selectedValues:f,onChange:b,placeholder:"Select Shift",fieldData:e})}),(0,r.jsx)(g.A,{label:"Student Name (Filter)",labelFor:"checkName",children:e=>(0,r.jsx)("input",{type:"text",id:"checkName",placeholder:"Search by name...",value:w,onChange:e=>D(e.target.value),className:e.className})})]}),(0,r.jsx)("div",{className:"flex justify-start",children:(0,r.jsx)(h.A,{label:"Check Status",color:"info",icon:i.U4M,onClick:()=>{Q()},disabled:G||!e||0===a.length&&0===f.length})})]}),R&&(0,r.jsx)(u.A,{color:"danger",icon:i.tPJ,className:"mb-4",children:R}),(0,r.jsx)(d.A,{className:"mb-6 rounded-lg shadow",hasTable:!0,children:G?(0,r.jsx)("p",{className:"p-6 text-center",children:"Loading student statuses..."}):F.length>0?(0,r.jsx)(j,{statuses:F,onViewDetails:Z}):e&&(a.length>0||f.length>0)&&!R?(0,r.jsx)(u.A,{color:"info",icon:i.U4M,children:"No students found for the selected criteria."}):(0,r.jsx)(u.A,{color:"info",children:"Please select a date and at least one class or shift to get a report."})}),z&&H&&M&&(0,r.jsx)(y.A,{student:H,attendanceRecords:E.filter(e=>e.studentId===H.id),approvedPermissions:_.filter(e=>e.studentId===H.id),allClassConfigs:M,isActive:z,onClose:()=>{B(!1),O(null)},initialMonthValue:(0,v.AZ)(new Date(e))})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[779,992,965,861,173,252,441,517,358],()=>t(5069)),_N_E=e.O()}]);