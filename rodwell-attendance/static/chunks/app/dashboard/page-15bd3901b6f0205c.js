(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[105],{3566:(e,t,s)=>{Promise.resolve().then(s.bind(s,9153))},8574:(e,t,s)=>{"use strict";s.d(t,{A:()=>o});var a=s(2175),l=s(5155);s(2115);var n=s(6778),r=s(2781);function i(e){let{label:t="",className:s="",icon:a=null,small:n=!1,onClick:i,onIconClick:o,labelClassName:c="",children:d}=e,u=n?"text-xs":"text-sm",h=a?o?(0,l.jsx)("button",{type:"button",onClick:e=>{e.stopPropagation(),o()},className:"flex-none items-center justify-center p-0.5 rounded-full hover:bg-gray-200 dark:hover:bg-gray-600 focus:outline-none ".concat(n&&t?"mr-1":"mr-1.5"),"aria-label":"icon-action",children:(0,l.jsx)(r.A,{path:a,w:"w-4",h:"h-4",size:n?14:20})}):(0,l.jsx)(r.A,{path:a,w:"w-4",h:"h-4",className:n&&t?"mr-1":"mr-1.5",size:n?14:void 0}):null;return(0,l.jsxs)("div",{className:"inline-flex items-center capitalize ".concat(u," ").concat(s," ").concat(i?"cursor-pointer":""),onClick:i,children:[h," ",t&&(0,l.jsx)("span",{className:"px-1 ".concat(c||""),children:t}),d]})}let o=e=>{var{small:t=!1,outline:s=!1,className:r="",onClick:o,onIconClick:c,labelClassName:d}=e,u=(0,a._)(e,["small","outline","className","onClick","onIconClick","labelClassName"]);let h=s?n.Fw[u.color]:n.cu[u.color],m=u.isGrouped?"mr-3 last:mr-0 mb-3":"",g=o&&!c?"cursor-pointer":"";return(0,l.jsx)(i,{className:"border rounded-full ".concat("py-1 px-3"," ").concat(h," ").concat(m," ").concat(g," ").concat(r),icon:u.icon,label:u.label,small:t,onClick:o,onIconClick:c,labelClassName:d})}},9153:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>E});var a=s(9233),l=s(5843),n=s(5155),r=s(2115),i=s(1063),o=s(2079),c=s(5632),d=s(198),u=s(6778),h=s(2781),m=s(4713),g=s(7801),f=s.n(g);let x=e=>{let{prefix:t="",suffix:s="",value:a,duration:l=500}=e,[i,o]=(0,r.useState)(0),c=i<1e3?i:f()(i).format("0,0"),d=[],u=e=>{let t=Math.ceil(i+e);if(t>a)return o(a),!1;o(t),d.push(setTimeout(()=>{u(e)},25))};return(0,r.useEffect)(()=>(u(a/(l/25)),()=>{d.forEach(e=>{clearTimeout(e)})})),(0,n.jsxs)("div",{children:[t,c,s]})};var p=s(2175),b=s(8574);let v=e=>{var{small:t=!1}=e,s=(0,p._)(e,["small"]);let a={up:i.Fb5,down:i.W5x,success:i.rvk,danger:i.PoQ,warning:i.VX1,info:i.nO4}[s.type];return(0,n.jsx)(b.A,{label:s.label,color:s.color,icon:a,small:t})},j=e=>(0,n.jsxs)(m.A,{children:[e.trendLabel&&e.trendType&&e.trendColor&&(0,n.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,n.jsx)(v,{label:e.trendLabel,type:e.trendType,color:e.trendColor,small:!0}),(0,n.jsx)(o.A,{icon:i.CZ3,color:"lightDark",small:!0})]}),(0,n.jsxs)("div",{className:"py-1 px-3 flex items-center justify-between",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h3",{className:"text-lg leading-tight text-gray-500 dark:text-slate-400",children:e.label}),(0,n.jsx)("h1",{className:"text-3xl leading-tight font-semibold",children:(0,n.jsx)(x,{value:e.number,prefix:e.numberPrefix,suffix:e.numberSuffix})})]}),e.icon&&(0,n.jsx)(h.A,{path:e.icon,size:"48",w:"",h:"h-16",className:u.Wj[e.iconColor]})]})]});var y=s(657),N=s(5111),w=s(7058),A=s(9496);let C=e=>{let{warning:t,student:s,allAttendanceRecordsForStudent:a,allClassConfigs:l,approvedPermissions:o}=e,[c,d]=(0,r.useState)(!1);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(m.A,{className:"pb-2 pt-1 pl-2 last:mb-0",children:(0,n.jsxs)("div",{className:"flex flex-col sm:flex-row items-center justify-between",children:[(0,n.jsxs)("div",{className:"flex-grow text-center sm:text-left overflow-hidden mb-4 sm:mb-0 sm:mr-3",children:[" ",(0,n.jsx)("h4",{className:"text-lg font-semibold truncate",children:t.fullName}),(0,n.jsxs)("p",{className:"text-sm text-gray-500 dark:text-slate-400",children:["Class: ",t.class||"N/A"," ",t.shift||"N/A"]})]}),(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[" ",(0,n.jsx)("button",{type:"button",onClick:()=>{d(!0)},className:"p-1 rounded-full transition-all duration-200 ease-in-out text-red-600 dark:text-red-400 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-opacity-75 hover:bg-red-500/20 dark:hover:bg-red-500/30 hover:shadow-md hover:shadow-red-400/30 dark:hover:shadow-md dark:hover:shadow-red-400/20",title:"View Attendance Details",children:(0,n.jsx)(b.A,{color:"totalLate"===t.warningType?"warning":"consecutiveAbsence"===t.warningType||"totalAbsence"===t.warningType?"danger":"info",label:t.details||"".concat(t.value),icon:i.WCY,className:"truncate pointer-events-none"})})]})]})}),c&&s&&l&&(0,n.jsx)(A.A,{student:s,attendanceRecords:a,approvedPermissions:o,allClassConfigs:l,isActive:c,onClose:()=>d(!1)})]})};var k=s(9532);let S=e=>{let{students:t,attendanceRecords:s,selectedMonthValue:a,selectedMonthLabel:l,allClassConfigs:o,approvedPermissions:c}=e,[u,h]=(0,r.useState)([]),[m,g]=(0,r.useState)(!0);return((0,r.useEffect)(()=>{if(!t||!s||!a){g(!1),h([]);return}g(!0);let e=[],[l,n]=a.split("-"),r=parseInt(l),i=parseInt(n)-1,{monthStartDateString:d,monthEndDateStringUsedForQuery:u}=(0,k.as)(r,i);t.forEach(t=>{let l=s.filter(e=>e.studentId===t.id&&e.date>=d&&e.date<=u),n=c.filter(e=>e.studentId===t.id),r=(0,k.AK)(t,l,a,o,n);r.count>=5&&e.push({id:t.id,fullName:t.fullName,class:t.class,shift:t.shift,warningType:"totalAbsence",value:r.count,details:r.details})}),h(e.sort((e,t)=>t.value-e.value).slice(0,5)),g(!1),console.log("Monthly Absences Warnings:",c)},[t,s,a,l]),m)?(0,n.jsxs)("div",{className:"mb-4",children:[(0,n.jsx)(d.A,{icon:i.gtj,title:"5+ Absences This Month"}),(0,n.jsx)("p",{className:"text-center p-4",children:"Calculating monthly absences..."})]}):(0,n.jsxs)("div",{className:"mb-4",children:[(0,n.jsx)(d.A,{icon:i.gtj,title:"5+ Absences (".concat(l||"Selected Month",")")}),u.length>0?(0,n.jsx)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:u.map(e=>{let a=s.filter(t=>t.studentId===e.id),l=t.find(t=>t.id===e.id);return l?(0,n.jsx)(C,{warning:e,student:l,approvedPermissions:c.filter(t=>t.studentId===e.id),allClassConfigs:o,allAttendanceRecordsForStudent:a},"".concat(e.id,"-consecutive")):null})}):(0,n.jsx)(y.A,{color:"info",icon:i.gtj,children:"No students with 5+ absences for the selected month."})]})},M=e=>{let{students:t,attendanceRecords:s,selectedMonthValue:a,selectedMonthLabel:l,allClassConfigs:o,approvedPermissions:c}=e,[u,h]=(0,r.useState)([]),[m,g]=(0,r.useState)(!0);return((0,r.useEffect)(()=>{if(!t||!s||!a){g(!1),h([]);return}g(!0);let[e,l]=a.split("-"),n=parseInt(e),r=parseInt(l)-1,{monthStartDateString:i,monthEndDateStringUsedForQuery:o}=(0,k.as)(n,r),c=[];t.forEach(e=>{let t=s.filter(t=>t.studentId===e.id&&t.date>=i&&t.date<=o),l=(0,k.zV)(e,t,a);l.count>=5&&c.push({id:e.id,fullName:e.fullName,class:e.class,shift:e.shift,warningType:"totalLate",value:l.count,details:l.details})}),h(c.sort((e,t)=>t.value-e.value).slice(0,5)),g(!1)},[t,s,a,l,o]),m)?(0,n.jsxs)("div",{className:"mb-6",children:[" ",(0,n.jsx)(d.A,{icon:i.d5P,title:"5+ Lates (".concat(l||"Selected Month",")")}),(0,n.jsx)("p",{className:"text-center p-4",children:"Calculating monthly lates..."})]}):(0,n.jsxs)("div",{className:"mb-6",children:[" ",(0,n.jsx)(d.A,{icon:i.d5P,title:"5+ Lates (".concat(l||"Selected Month",")")}),u.length>0?(0,n.jsx)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:u.map(e=>{let a=t.find(t=>t.id===e.id),l=s.filter(t=>t.studentId===e.id);return a?(0,n.jsx)(C,{warning:e,student:a,approvedPermissions:null!=c?c:[],allAttendanceRecordsForStudent:l,allClassConfigs:o},"".concat(e.id,"-totallate")):null})}):(0,n.jsxs)(y.A,{color:"info",icon:i.d5P,children:["No students with 5+ lates for ",l||"the selected period","."]})]})},P=e=>{let{students:t,attendanceRecords:s,allClassConfigs:a,approvedPermissions:l}=e,[o,c]=(0,r.useState)([]),[u,h]=(0,r.useState)(!0);return((0,r.useEffect)(()=>{if(!t||!s||!a){h(!1),c([]);return}h(!0);let e=[];t.forEach(t=>{let n=s.filter(e=>e.studentId===t.id),r=l.filter(e=>e.studentId===t.id),i=(0,k.rM)(t,n,a,r,14);i.count>=2&&e.push({id:t.id,fullName:t.fullName,class:t.class,shift:t.shift,warningType:"consecutiveAbsence",value:i.count,details:i.details})}),c(e.sort((e,t)=>t.value-e.value).slice(0,5)),h(!1)},[t,s,a]),u||!a)?(0,n.jsxs)("div",{className:"mb-6",children:[(0,n.jsx)(d.A,{icon:i.Xvy,title:"Recent Consecutive Absences (2+)"}),(0,n.jsx)("p",{className:"text-center p-4",children:"Calculating..."})]}):(0,n.jsxs)("div",{className:"mb-6",children:[(0,n.jsx)(d.A,{icon:i.Xvy,title:"Recent Consecutive Absences (2+)"}),o.length>0?(0,n.jsx)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:o.map(e=>{let r=s.filter(t=>t.studentId===e.id),i=t.find(t=>t.id===e.id);return i?(0,n.jsx)(C,{warning:e,student:i,allClassConfigs:a,approvedPermissions:l.filter(t=>t.studentId===e.id),allAttendanceRecordsForStudent:r},"".concat(e.id,"-consecutive")):null})}):(0,n.jsx)(y.A,{color:"info",icon:i.Xvy,children:"No students with 2+ recent consecutive school day absences."})]})};var I=s(8449);function E(){var e;let[t,s]=(0,r.useState)([]),[u,m]=(0,r.useState)([]),[g,f]=(0,r.useState)(!0),[x,p]=(0,r.useState)(null),[b,v]=(0,r.useState)((0,I.AZ)()),[A,C]=(0,r.useState)([]),[E,T]=(0,r.useState)(!1),L=(0,r.useRef)(null),[_,D]=(0,r.useState)(null),[F,R]=(0,r.useState)(!0),[G,z]=(0,r.useState)([]);(0,r.useEffect)(()=>{let e=[],t=new Date,s=t.getFullYear(),a=t.getMonth();for(let t=0;t<=a;t++){let a=new Date(s,t,1);e.push({value:"".concat(s,"-").concat(String(t+1).padStart(2,"0")),label:a.toLocaleString("default",{month:"long",year:"numeric"})})}C(e.reverse())},[]),(0,r.useEffect)(()=>{let e=e=>{L.current&&!L.current.contains(e.target)&&T(!1)};return E&&document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[E]);let W=(0,r.useCallback)(async()=>{f(!0),R(!0),p(null);try{let e=(0,w.GG)((0,w.P)((0,w.rJ)(N.db,"students"),(0,w.My)("fullName"))),t=new Date;t.setDate(t.getDate()-60);let n="".concat(t.getFullYear(),"-").concat(String(t.getMonth()+1).padStart(2,"0"),"-").concat(String(t.getDate()).padStart(2,"0")),r=(0,w.GG)((0,w.P)((0,w.rJ)(N.db,"attendance"),(0,w._M)("date",">=",n),(0,w.My)("date","desc"))),i=(0,w.GG)((0,w.P)((0,w.rJ)(N.db,"classes"),(0,w.My)("name"))),o=(0,w.GG)((0,w.P)((0,w.rJ)(N.db,"permissions"),(0,w._M)("status","==","approved"))),[c,d,u,h]=await Promise.all([e,r,i,o]),g=c.docs.map(e=>(0,l._)((0,a._)({id:e.id},e.data()),{createdAt:e.data().createdAt}));s(g);let f=d.docs.map(e=>(0,a._)({id:e.id},e.data()));m(f);let x=h.docs.map(e=>(0,a._)({id:e.id},e.data()));z(x),console.log("Dashboard: Fetched ".concat(x.length," approved permissions."));let p={};u.empty&&console.warn("No documents found in 'classes' collection for dashboard."),u.forEach(e=>{p[e.id]=e.data()}),D(p),R(!1)}catch(e){console.error("Error fetching dashboard data:",e),p("Failed to load dashboard data."),"failed-precondition"===e.code&&e.message.includes("index")&&p("Query requires a new index. Check console for link."),R(!1)}f(!1)},[]);(0,r.useEffect)(()=>{W()},[W]);let O=(0,I.AZ)(new Date).substring(0,7)+"-"+String(new Date().getDate()).padStart(2,"0"),V=(0,r.useMemo)(()=>u.filter(e=>e.date===O&&"present"===e.status).length,[u,O]),J=(0,r.useMemo)(()=>u.filter(e=>e.date===O&&"late"===e.status).length,[u,O]),X=(0,r.useMemo)(()=>_&&0!==t.length?t.filter(e=>{let t=u.find(t=>t.studentId===e.id&&t.date===O),s=G.filter(t=>t.studentId===e.id),a=(0,k.tE)(e,O,t,_,s);return"Absent"===a.status||"Absent (Config Missing)"===a.status}).length:0,[t,u,G,_,O]),K=(0,r.useMemo)(()=>_&&0!==t.length?t.filter(e=>{let t=u.find(t=>t.studentId===e.id&&t.date===O),s=G.filter(t=>t.studentId===e.id);return"Pending"===(0,k.tE)(e,O,t,_,s).status}).length:0,[t,u,G,_]),Y=(0,r.useMemo)(()=>{var e;return(null===(e=A.find(e=>e.value===b))||void 0===e?void 0:e.label)||b},[A,b]);return g&&0===t.length||F?(0,n.jsx)(c.A,{children:(0,n.jsx)("p",{className:"text-center p-6",children:"Loading dashboard data..."})}):(0,n.jsxs)(c.A,{children:[(0,n.jsx)(d.A,{icon:i.FNh,title:"Overview",main:!0,children:(0,n.jsx)(o.A,{onClick:W,icon:i.kWq,label:"Refresh Data",color:"info",small:!0})}),(0,n.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-2 gap-6 mb-6",children:[(0,n.jsx)(j,{label:"Total Students",number:t.length,icon:i.Krx,iconColor:"info"}),(0,n.jsx)(j,{label:"Present Today",number:V,icon:i.Krx,iconColor:"success"})]}),(0,n.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 mb-6",children:[(0,n.jsx)(j,{label:"Late Today",number:J,icon:i.d5P,iconColor:"warning"}),(0,n.jsx)(j,{label:"Absent Today",number:X,icon:i.lBC,iconColor:"danger"}),(0,n.jsx)(j,{label:"Pending Today",number:K,icon:i.MoT,iconColor:"info",trendLabel:"Shift Open"})]}),x&&(0,n.jsx)(y.A,{color:"danger",icon:i.gtj,children:x}),(0,n.jsx)(P,{students:t,attendanceRecords:u,allClassConfigs:_,approvedPermissions:G.filter(e=>e.studentId&&"approved"===e.status)}),(0,n.jsx)(d.A,{icon:i.hu3,title:"Monthly Reports",main:!0,children:(0,n.jsxs)("div",{className:"relative w-56",ref:L,children:[" ",(0,n.jsxs)("button",{type:"button",onClick:()=>T(!E),className:"text-sm font-medium text-gray-700 dark:text-gray-200 bg-white dark:bg-slate-700 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm px-4 py-2 inline-flex justify-between items-center w-full hover:bg-gray-50 dark:hover:bg-slate-600 focus:outline-none focus:ring-2 focus:ring-offset-1 focus:ring-indigo-500 dark:focus:ring-offset-slate-800",children:[(0,n.jsx)("span",{children:(null===(e=A.find(e=>e.value===b))||void 0===e?void 0:e.label)||"Select Month"}),(0,n.jsx)(h.A,{path:i.W5x,w:"h-4 w-4",className:"ml-2 text-gray-400 transform transition-transform duration-200 ".concat(E?"rotate-180":"")})]}),E&&A.length>0&&(0,n.jsx)("div",{className:"origin-top-right absolute right-0 mt-2 w-56 rounded-md shadow-lg bg-white dark:bg-slate-700 ring-1 ring-black dark:ring-gray-600 ring-opacity-5 focus:outline-none z-10",children:(0,n.jsx)("ul",{className:"py-1 max-h-60 overflow-y-auto",role:"menu",children:A.map(e=>(0,n.jsx)("li",{children:(0,n.jsx)("button",{type:"button",className:"block w-full text-left px-4 py-2 text-sm ".concat(b===e.value?"bg-gray-100 dark:bg-gray-600 text-gray-900 dark:text-white":"text-gray-700 dark:text-gray-200"," hover:bg-gray-100 dark:hover:bg-gray-600"),onClick:()=>{v(e.value),T(!1)},children:e.label})},e.value))})})]})}),!g&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(S,{students:t,attendanceRecords:u,selectedMonthValue:b,approvedPermissions:G.filter(e=>e.studentId&&"approved"===e.status),selectedMonthLabel:Y,allClassConfigs:_}),(0,n.jsx)(M,{students:t,attendanceRecords:u,selectedMonthValue:b,approvedPermissions:G,selectedMonthLabel:Y,allClassConfigs:_})]})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[779,992,965,861,173,801,252,441,517,358],()=>t(3566)),_N_E=e.O()}]);