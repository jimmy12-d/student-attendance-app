(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[617],{8860:(e,r,t)=>{Promise.resolve().then(t.bind(t,3119))},4713:(e,r,t)=>{"use strict";t.d(r,{A:()=>s});var a=t(5155),n=t(2115);function l(e){let{noPadding:r=!1,className:t,children:n}=e;return(0,a.jsx)("div",{className:"flex-1 ".concat(r?"":"p-2"," ").concat(t),children:n})}function o(e){let{className:r,children:t}=e;return(0,a.jsx)("footer",{className:"p-6 ".concat(r),children:t})}function s(e){let{rounded:r="rounded-2xl",flex:t="flex-col",className:s="",hasComponentLayout:i=!1,hasTable:c=!1,isHoverable:d=!1,isModal:u=!1,children:g,footer:h,onClick:b}=e,f=["bg-white flex",s,r,t,u?"dark:bg-slate-900":"dark:bg-slate-900/70"];return d&&f.push("hover:shadow-lg transition-shadow duration-500"),n.createElement("div",{className:f.join(" "),onClick:b},i?g:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(l,{noPadding:c,children:g}),h&&(0,a.jsx)(o,{children:h})]}))}},2781:(e,r,t)=>{"use strict";t.d(r,{A:()=>n});var a=t(5155);function n(e){let{path:r,w:t="w-6",h:n="h-6",size:l=null,className:o="",children:s}=e,i=null!=l?l:16;return(0,a.jsxs)("span",{className:"inline-flex justify-center items-center ".concat(t," ").concat(n," ").concat(o),children:[(0,a.jsx)("svg",{viewBox:"0 0 24 24",width:i,height:i,className:"inline-block",children:(0,a.jsx)("path",{fill:"currentColor",d:r})}),s]})}t(2115)},5632:(e,r,t)=>{"use strict";t.d(r,{A:()=>l});var a=t(5155);t(2115);var n=t(9732);function l(e){let{children:r}=e;return(0,a.jsx)("section",{className:"bg-gray-100 dark:bg-gray-800 p-6 ".concat(n.Fx),children:r})}},198:(e,r,t)=>{"use strict";t.d(r,{A:()=>s});var a=t(5155);t(2115);var n=t(2781),l=t(6778);function o(e){let{icon:r,color:t,w:o="w-12",h:s="h-12",bg:i=!1,className:c=""}=e,d=i?l.cu[t]:"".concat(l.Wj[t]," bg-gray-50 dark:bg-slate-800");return(0,a.jsx)(n.A,{path:r,w:o,h:s,size:"24",className:"rounded-full ".concat(d," ").concat(c)})}function s(e){let{icon:r,title:t,main:l=!1,children:s}=e;return(0,a.jsxs)("section",{className:"".concat(l?"":"pt-6"," mb-6 flex items-center justify-between"),children:[(0,a.jsxs)("div",{className:"flex items-center justify-start",children:[r&&l&&(0,a.jsx)(o,{icon:r,color:"light",className:"mr-3",bg:!0}),r&&!l&&(0,a.jsx)(n.A,{path:r,className:"mr-2",size:"20"}),(0,a.jsx)("h1",{className:"leading-tight ".concat(l?"text-3xl":"text-2xl"),children:t})]}),s]})}},6778:(e,r,t)=>{"use strict";t.d(r,{Fw:()=>c,Wj:()=>i,an:()=>l,cu:()=>s,mc:()=>n,sG:()=>d,xY:()=>o});let a="bg-linear-to-tr",n="".concat(a," from-purple-400 via-pink-500 to-red-500"),l="".concat(a," from-slate-700 via-slate-900 to-slate-800"),o="".concat(a," from-pink-400 via-red-500 to-yellow-500"),s={white:"bg-white text-black",light:"bg-white text-black dark:bg-slate-900/70 dark:text-white",contrast:"bg-gray-800 text-white dark:bg-white dark:text-black",success:"bg-emerald-500 border-emerald-500 text-white",danger:"bg-red-500 border-red-500 text-white",warning:"bg-yellow-500 border-yellow-500 text-white",info:"bg-blue-500 border-blue-500 text-white"},i={white:"text-black dark:text-slate-100",light:"text-gray-700 dark:text-slate-400",contrast:"dark:text-white",success:"text-emerald-500",danger:"text-red-500",warning:"text-yellow-500",info:"text-blue-500"},c={white:[i.white,"border-gray-100"].join(" "),light:[i.light,"border-gray-100"].join(" "),contrast:[i.contrast,"border-gray-900 dark:border-slate-100"].join(" "),success:[i.success,"border-emerald-500"].join(" "),danger:[i.danger,"border-red-500"].join(" "),warning:[i.warning,"border-yellow-500"].join(" "),info:[i.info,"border-blue-500"].join(" ")},d=function(e,r,t){let a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if("void"===e)return"";let n={ring:{white:"ring-gray-200 dark:ring-gray-500",whiteDark:"ring-gray-200 dark:ring-gray-500",lightDark:"ring-gray-200 dark:ring-gray-500",contrast:"ring-gray-300 dark:ring-gray-400",success:"ring-emerald-300 dark:ring-emerald-700",danger:"ring-red-300 dark:ring-red-700",warning:"ring-yellow-300 dark:ring-yellow-700",info:"ring-blue-300 dark:ring-blue-700"},active:{white:"bg-gray-100",whiteDark:"bg-gray-100 dark:bg-slate-800",lightDark:"bg-gray-200 dark:bg-slate-700",contrast:"bg-gray-700 dark:bg-slate-100",success:"bg-emerald-700 dark:bg-emerald-600",danger:"bg-red-700 dark:bg-red-600",warning:"bg-yellow-700 dark:bg-yellow-600",info:"bg-blue-700 dark:bg-blue-600"},bg:{white:"bg-white text-black",whiteDark:"bg-white text-black dark:bg-slate-900 dark:text-white",lightDark:"bg-gray-100 text-black dark:bg-slate-800 dark:text-white",contrast:"bg-gray-800 text-white dark:bg-white dark:text-black",success:"bg-emerald-600 dark:bg-emerald-500 text-white",danger:"bg-red-600 dark:bg-red-500 text-white",warning:"bg-yellow-600 dark:bg-yellow-500 text-white",info:"bg-blue-600 dark:bg-blue-500 text-white"},bgHover:{white:"hover:bg-gray-100",whiteDark:"hover:bg-gray-100 dark:hover:bg-slate-800",lightDark:"hover:bg-gray-200 dark:hover:bg-slate-700",contrast:"hover:bg-gray-700 dark:hover:bg-slate-100",success:"hover:bg-emerald-700 hover:border-emerald-700 dark:hover:bg-emerald-600 dark:hover:border-emerald-600",danger:"hover:bg-red-700 hover:border-red-700 dark:hover:bg-red-600 dark:hover:border-red-600",warning:"hover:bg-yellow-700 hover:border-yellow-700 dark:hover:bg-yellow-600 dark:hover:border-yellow-600",info:"hover:bg-blue-700 hover:border-blue-700 dark:hover:bg-blue-600 dark:hover:border-blue-600"},borders:{white:"border-white",whiteDark:"border-white dark:border-slate-900",lightDark:"border-gray-100 dark:border-slate-800",contrast:"border-gray-800 dark:border-white",success:"border-emerald-600 dark:border-emerald-500",danger:"border-red-600 dark:border-red-500",warning:"border-yellow-600 dark:border-yellow-500",info:"border-blue-600 dark:border-blue-500"},text:{contrast:"dark:text-slate-100",success:"text-emerald-600 dark:text-emerald-500",danger:"text-red-600 dark:text-red-500",warning:"text-yellow-600 dark:text-yellow-500",info:"text-blue-600 dark:text-blue-500"},outlineHover:{contrast:"hover:bg-gray-800 hover:text-gray-100 dark:hover:bg-slate-100 dark:hover:text-black",success:"hover:bg-emerald-600 hover:text-white hover:text-white dark:hover:text-white dark:hover:border-emerald-600",danger:"hover:bg-red-600 hover:text-white hover:text-white dark:hover:text-white dark:hover:border-red-600",warning:"hover:bg-yellow-600 hover:text-white hover:text-white dark:hover:text-white dark:hover:border-yellow-600",info:"hover:bg-blue-600 hover:text-white dark:hover:text-white dark:hover:border-blue-600"}},l=r&&0>["white","whiteDark","lightDark"].indexOf(e),o=[n.borders[e],n.ring[e]];return a?o.push(n.active[e]):o.push(l?n.text[e]:n.bg[e]),t&&o.push(l?n.outlineHover[e]:n.bgHover[e]),o.join(" ")}},9732:(e,r,t)=>{"use strict";t.d(r,{Fx:()=>a,wS:()=>n});let a="xl:max-w-6xl xl:mx-auto",n=e=>"".concat(e," â€” ").concat("Rodwell Attendance")},8449:(e,r,t)=>{"use strict";t.d(r,{AZ:()=>o,Lj:()=>a,l0:()=>n,sU:()=>l});let a=15,n=60,l=new Set(["2025-01-01","2025-01-07","2025-03-08","2025-05-01","2025-05-14","2025-05-15","2025-05-16","2025-06-18","2025-09-24","2025-10-07","2025-10-08","2025-10-09","2025-10-15","2025-10-29","2025-11-09","2025-11-20","2025-11-21","2025-11-22"]),o=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Date,r=e.getFullYear(),t=String(e.getMonth()+1).padStart(2,"0");return"".concat(r,"-").concat(t)}},3119:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>p});var a=t(5155),n=t(1063),l=t(6793),o=t.n(l),s=t(5632),i=t(198),c=t(9732),d=t(9233),u=t(2115),g=t(8129),h=t(5111),b=t(7058),f=t(4713),m=t(8449);let w="qr-video-reader-container",x=["Fashionably late, I see!","Better late than never, right?","AGAIN! How many times already?","You must have a good excuse this time!","You know the rules, right?","Glad you could make it!","Traffic was bad, huh? \uD83D\uDE09"],y=e=>{let r=x[Math.floor(Math.random()*x.length)];return"".concat(e," is LATE! ").concat(r)},k=()=>{let[e,r]=(0,u.useState)(null),[t,n]=(0,u.useState)(null),[l,o]=(0,u.useState)(!1),s=(0,u.useRef)(null),i=(0,u.useRef)(null),c=(0,u.useRef)(null),x=(0,u.useRef)(null),k=(0,u.useRef)(null),p=(0,u.useRef)(null),[v,S]=(0,u.useState)(null),[j,N]=(0,u.useState)(!0);(0,u.useEffect)(()=>{if("undefined"!=typeof Audio)try{k.current=new Audio("".concat("","/success_sound_2.mp3"))}catch(e){console.warn("Could not initialize audio:",e)}(async()=>{N(!0);try{let e=await (0,b.GG)((0,b.rJ)(h.db,"classes")),r={};e.forEach(e=>{r[e.id]=e.data()}),S(r)}catch(e){console.error("Failed to fetch class configurations:",e)}N(!1)})()},[]),(0,u.useEffect)(()=>()=>{x.current&&clearTimeout(x.current),c.current&&clearTimeout(c.current)},[]);let C=(0,u.useCallback)(()=>{k.current&&(k.current.currentTime=0,k.current.play().catch(e=>console.warn("Error playing sound:",e)))},[]),T=(0,u.useCallback)((e,t)=>{n({type:e,text:t}),x.current&&clearTimeout(x.current),x.current=setTimeout(()=>{n(null),r(null)},3e3)},[]),A=(0,u.useCallback)(async e=>{if(i.current!==e){if(i.current=e,c.current&&clearTimeout(c.current),c.current=setTimeout(()=>{i.current=null},3e3),console.log("QR Scanned - Raw: ".concat(e)),RegExp("^(https?|ftp|file)://[-A-Z0-9+&@#/%?=~_|!:,.;]*[-A-Z0-9+&@#/%=~_|]","i").test(e)){T("error","Scanned a URL. Please scan a valid Student ID QR code.");return}if(!/^[a-zA-Z0-9]{15,25}$/.test(e)||e.includes("/")||e.includes(".")){T("error","Invalid Student ID format: ".concat(e.substring(0,30),"..."));return}try{let t=(0,b.H9)(h.db,"students",e),a=await (0,b.x7)(t);if(!a.exists()){T("error","Student ID [".concat(e,"] not found."));return}let n=(0,d._)({id:a.id},a.data());r("".concat(n.fullName," (Class: ").concat(n.class||"N/A",")"));let l=new Date,o="".concat(l.getFullYear(),"-").concat(String(l.getMonth()+1).padStart(2,"0"),"-").concat(String(l.getDate()).padStart(2,"0")),s=(0,b.P)((0,b.rJ)(h.db,"attendance"),(0,b._M)("studentId","==",e),(0,b._M)("date","==",o)),i=await (0,b.GG)(s);if(!i.empty){let e=i.docs[0].data().status||"present";T("info","".concat(n.fullName," already marked ").concat(e," today."));return}let c="present",u=n.class,g=n.shift;if(console.log("[STATUS LOGIC] Student: <span class=\"math-inline\">{studentData.fullName}, Class: '</span>{studentClassKey}', Shift: '".concat(g,"'")),j){T("error","Class time configurations are still loading. Please try again shortly.");return}if(!v){T("error","Class time configurations not loaded. Cannot determine status accurately.");return}let f=u?v[u]:void 0,w=g&&(null==f?void 0:f.shifts)?f.shifts[g]:void 0;if(w&&w.startTime){console.log("[STATUS LOGIC] Found shift config for ".concat(u," - ").concat(g,": StartTime ").concat(w.startTime));let[e,r]=w.startTime.split(":").map(Number),t=new Date(l);t.setHours(e,r,0,0);let a="number"!=typeof n.gracePeriodMinutes||isNaN(n.gracePeriodMinutes)?m.Lj:n.gracePeriodMinutes,o=new Date(t);o.setMinutes(t.getMinutes()+a),new Date(o).setMinutes(o.getMinutes()+m.l0),c=l<=o?"present":"late",console.log("[STATUS LOGIC] Determined Status: ".concat(c.toUpperCase()))}else console.warn("[STATUS LOGIC] Shift config not found for Class '<span class=\"math-inline\">{studentClassKey}', Shift '</span>{studentShiftKey}'. Defaulting to 'present'. This might happen if class/shift names in student record don't match keys in 'classes' collection."),c="present";console.log("[DB SAVE] Final attendanceStatus: '".concat(c,"' for ").concat(n.fullName)),await (0,b.gS)((0,b.rJ)(h.db,"attendance"),{studentId:e,studentName:n.fullName,class:n.class||null,shift:g||null,date:o,timestamp:(0,b.O5)(),status:c}),C(),"late"===c?T("warning",y(n.fullName)):T("success","".concat(n.fullName," marked present!"))}catch(e){console.error("Error processing attendance:",e),T("error","Error processing: ".concat(e.message||"Unknown error"))}}},[C,T,v,j]),D=(0,u.useCallback)(e=>{e.includes("QR code not found")||e.includes("notFound")||e.includes("No QR code found")||console.warn("QR Scan Failure: ".concat(e))},[]),I=(0,u.useCallback)(async()=>{if(!p.current){T("error","Video container element not found."),o(!1);return}p.current.innerHTML="",console.log("initializeScanner: Initializing new scanner instance.");let e=new g.j9(w,{verbose:!1});s.current=e;try{let r=await g.j9.getCameras();if(!l||s.current!==e){console.log("Scanner start aborted: isScanning changed or ref mismatch during getCameras."),s.current===e&&(s.current=null);return}if(r&&r.length){let t=r[0].id,a=r.find(e=>e.label&&e.label.toLowerCase().includes("back"));a&&(t=a.id),await e.start(t,{fps:10,qrbox:(e,r)=>{let t=Math.max(100,Math.floor(.8*Math.min(e,r)));return{width:t,height:t}}},A,D),console.log("Scanner started successfully by initializeScanner.")}else T("error","No cameras found."),o(!1),s.current=null}catch(r){console.error("Error during scanner initialization or start process:",r),T("error","Camera Error: ".concat(r.message)),o(!1),s.current===e&&(s.current=null)}},[l,A,D,T]);return(0,u.useEffect)(()=>{if(l&&!s.current&&p.current){if(p.current.clientWidth>0||p.current.clientHeight>0)I();else{let e=setTimeout(()=>{l&&!s.current&&p.current&&(p.current.clientWidth>0||p.current.clientHeight>0)?I():l&&(console.error("Still no dimensions for video container after delay."),T("error","Camera view could not be sized. Try again."),o(!1))},50);return()=>clearTimeout(e)}}return()=>{if(s.current){let e=s.current;s.current=null,e.isScanning?e.stop().then(()=>console.log("Scanner stopped in useEffect cleanup.")).catch(e=>console.warn("Error stopping scanner in useEffect cleanup:",e.message||e)).finally(()=>{p.current&&(p.current.innerHTML="")}):p.current&&(p.current.innerHTML="")}}},[l,I,A,D,T]),(0,a.jsxs)(f.A,{className:"mx-auto max-w-3xl p-6 bg-gray-800 shadow-lg rounded-lg",children:[(0,a.jsx)("h2",{className:"text-2xl md:text-3xl font-bold mb-6 text-center text-white-800",children:"Scan Student QR"}),(0,a.jsx)("div",{ref:p,id:w,className:"w-full rounded-md overflow-hidden mb-4 border-2 border-gray-300 bg-gray-900",style:{minHeight:"280px",width:"100%",transform:"scaleX(-1)"},children:!l&&!s.current&&(0,a.jsx)("div",{className:"flex items-center justify-center h-full",style:{transform:"scaleX(-1)"},children:(0,a.jsx)("p",{className:"text-gray-400 text-center p-10",children:"Camera feed will appear here."})})}),(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row justify-center space-y-3 sm:space-y-0 sm:space-x-4 mb-6",children:[(0,a.jsx)("button",{onClick:()=>{if(j){T("info","System is initializing. Please wait a moment.");return}l||(n(null),r(null),p.current,o(!0))},disabled:l||j,className:"px-6 py-3 bg-green-600 text-white font-semibold rounded-lg shadow-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-400 focus:ring-opacity-75 disabled:opacity-60 transition duration-150 ease-in-out",children:j?"Loading Config...":"Start Scan"}),(0,a.jsx)("button",{onClick:()=>{if(l)console.log("handleStopScan: Setting isScanning to false."),o(!1);else if(s.current){console.warn("handleStopScan: isScanning is false, but ref exists. Forcing cleanup of lingering ref.");let e=s.current;s.current=null,e.isScanning?e.stop().catch(()=>{}).finally(()=>{p.current&&(p.current.innerHTML="")}):p.current&&(p.current.innerHTML="")}else console.log("handleStopScan: isScanning is already false and no ref exists.")},disabled:!l,className:"px-6 py-3 bg-red-600 text-white font-semibold rounded-lg shadow-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-400 focus:ring-opacity-75 disabled:opacity-60 transition duration-150 ease-in-out",children:"Stop Scan"})]}),e&&!t&&(0,a.jsx)("div",{className:"text-center p-3 mb-4 bg-blue-50 border border-blue-200 rounded-md",children:(0,a.jsxs)("p",{className:"text-lg font-medium text-blue-700 animate-pulse",children:["Scanned: ",e]})}),t&&(0,a.jsx)("div",{className:"text-center p-3 my-3 rounded-md text-base font-medium border\n            ".concat("success"===t.type?"bg-green-50 text-green-700 border-green-300":"","\n            ").concat("error"===t.type?"bg-red-50 text-red-700 border-red-300":"","\n            ").concat("info"===t.type?"bg-blue-50 text-blue-700 border-blue-300":"","\n            ").concat("warning"===t.type?"bg-yellow-100 text-yellow-800 border-yellow-400":""," \n            "),children:t.text})]})};function p(){return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(o(),{children:(0,a.jsx)("title",{children:(0,c.wS)("Forms")})}),(0,a.jsxs)(s.A,{children:[(0,a.jsx)(i.A,{icon:n.P5I,title:"Scan QR Code",main:!0}),(0,a.jsx)(k,{})]})]})}},5111:(e,r,t)=>{"use strict";t.d(r,{db:()=>s,j:()=>i});var a=t(9904),n=t(7058),l=t(4565);let o=(0,a.Wp)({apiKey:"AIzaSyBlUIZfsrgVvfw4fL2poyITh0bfM9Iumag",authDomain:"rodwell-attendance.firebaseapp.com",projectId:"rodwell-attendance",storageBucket:"rodwell-attendance.firebasestorage.app",messagingSenderId:"50079853705",appId:"1:50079853705:web:5e9d3dcb42b4d0d874aa58"}),s=(0,n.aU)(o),i=(0,l.xI)(o)}},e=>{var r=r=>e(e.s=r);e.O(0,[779,992,965,604,861,185,441,517,358],()=>r(8860)),_N_E=e.O()}]);